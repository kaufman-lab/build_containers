# build_containers

This repo builds and stores singularity images to be used in lab workflows.

## Available Images

The set of image types that are available are displayed on the right under "packages".

There are two images types:

-   `geospatial_plus`: Builds on the [rocker](https://github.com/rocker-org/rocker-versioned2) geospatial docker image.

    -   includes a few additional packages (including data.table, intervalaverage and terra)

    -   also has configured the R user library location to avoid clashing with the user library on the host machine.

-   `geospatial_plus_ml`

    -   additionally includes torch for R, and tensorflow for python, and the reticulate package. The version of tensorflow is specifically intel's version for avx512 since this is primarily intended to be run on an intel high performance compute (HPC) cluster.

-   `geospatial_plus_ml_horovod`

    -   additionally includes horovod (tensorflow only, set up for CPU) and openmpi.

## Using Images

If you'd like to test out an image interactively, try

    singularity shell oras://ghcr.io/kaufman-lab/geospatial_plus:4.1.0

Note that singularity will cache remote images, so there's no need to explicitly save an images to disk using `singularity pull`, even if you're using it repeatedly.

Note that in order to use these images with singularity you need to preface the package fingerprints with `oras://` (as in the examples).

Please disregard the instructions under packages on how to pull these images using docker commands. These are not docker images and those commands will not work. Those instructions are auto-generated by github and I don't know how to turn them off.

## Image Requests

Submit an issue if you'd like additional packages or software built into an image.

Depending on the complexity, we may start a new image type (package) or add to an existing package.

## Image Stability

starting sometime after 8/10/21 \`geospatial_plus:4.1.0\` will be package-stable (this is the date the next version of R is released and rocker will freeze 4.1.0). Even as rocker/geospatial:4.1.0 and kaufman-lab/geospatial_plus:4.1.0 are periodically rebuilt, R packages in the 4.1.0 image will remain constant [because of how versioned rocker images install packages](https://github.com/rocker-org/rocker-versioned2/issues/201).

## Building Images

This repository uses github actions to build images. Inspiration for this repo, along with more complicated examples for building multiple images can be found here: <https://github.com/singularityhub/github-ci>
